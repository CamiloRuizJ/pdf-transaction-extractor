{% extends 'base.html' %}
{% block title %}PDF Transaction Extractor ‚Äî Tool{% endblock %}

{% block content %}

<section class="tool-hero container">
  <h1 class="tool-title">PDF Transaction Extractor</h1>
  <p class="tool-subtitle">Extract structured data from commercial real estate PDF reports</p>
</section>

<section id="viewer" class="container tool-shell">
  <div class="main-content">
    <!-- Upload Section -->
    <div class="upload-section" id="uploadSection">
      <div class="upload-icon">üìÑ</div>
      <div class="upload-text">Drag and drop your PDF file here or click to browse</div>
      <input type="file" id="fileInput" class="file-input" accept=".pdf">
      <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Choose PDF File</button>
    </div>

    <!-- PDF Viewer Section -->
    <div class="pdf-viewer" id="pdfViewer" style="display: none;">
      <div class="pdf-controls">
        <div class="zoom-controls">
          <button class="btn-zoom" onclick="zoomOut()" title="Zoom Out (Ctrl + Scroll)">‚àí</button>
          <span class="zoom-level" id="zoomLevel">100%</span>
          <button class="btn-zoom" onclick="zoomIn()" title="Zoom In (Ctrl + Scroll)">+</button>
          <button class="btn-reset" onclick="resetZoom()" title="Reset Zoom">Reset</button>
        </div>
        <div class="pan-controls">
          <button class="btn-small btn-pan" onclick="togglePanMode()" id="panBtn" title="Toggle Pan Mode (or hold Space)">üñêÔ∏è</button>
        </div>
      </div>
      <div class="zoom-info">Tip: Use +/- buttons to zoom, click pan button or hold Space to pan. Higher zoom = more accurate selections!</div>
      <div class="canvas-container" id="canvasContainer">
        <canvas id="pdfCanvas" class="pdf-canvas"></canvas>
      </div>
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Processing PDF...</div>
      </div>
    </div>

    <!-- Excel Preview Section -->
    <div class="excel-preview-section" id="excelPreviewSection">
      <div class="section-title">Excel Preview</div>
      <div class="preview-controls">
        <button class="preview-toggle active" id="previewToggle" onclick="togglePreview()">Hide Preview</button>
        <span style="font-size: 12px; color: #6c757d;">Drag the preview to move it around</span>
      </div>
      <div class="column-controls" id="columnControls" style="display: none;">
        <button class="column-control-btn" onclick="addColumn()" type="button">Add Column</button>
        <button class="column-control-btn" onclick="removeColumn()" type="button">Remove Column</button>
        <button class="column-control-btn" onclick="clearAllData()" type="button">Clear All Data</button>
        <button class="column-control-btn" onclick="resetExcelPreview()" type="button">Reset Preview</button>
        <span style="font-size: 11px; color: #6c757d;">Click cells to edit, drag headers to reorder</span>
      </div>
      <div class="excel-preview-container" id="excelPreviewContainer">
        <div class="excel-preview" id="excelPreview">
          <div style="text-align: center; color: #6c757d; padding: 40px 20px; font-size: 16px;">
            <div style="font-size: 48px; margin-bottom: 16px;">üìä</div>
            <div style="font-weight: 600; margin-bottom: 8px;">Excel Preview</div>
            <div style="font-size: 14px; opacity: 0.8; line-height: 1.4;">This is where your extracted data will appear<br>in a spreadsheet format once you define regions</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Extraction Section -->
    <div class="data-extraction-section" id="dataExtractionSection" style="display: none;">
      <div class="section-title">Data Extraction</div>
      <div class="action-buttons">
        <button class="btn btn-success" id="extractDataBtn" disabled>Extract Data</button>
        <button class="btn btn-info" id="testOcrBtn" onclick="testOcr()">Test OCR</button>
        <button class="btn btn-danger" id="clearSessionBtn">Clear Session</button>
      </div>
      <div id="extractionStatus"></div>
    </div>
  </div>

  <div class="control-panel">
    <div class="section file-info-section">
      <div class="section-title">File Information</div>
      <div class="info-item">
        <div class="info-label">File Name:</div>
        <div class="info-value" id="fileName">No file selected</div>
      </div>
      <div class="info-item">
        <div class="info-label">Pages:</div>
        <div class="info-value" id="pageCount">-</div>
      </div>
      <div class="info-item">
        <div class="info-label">Current Page:</div>
        <div class="info-value" id="currentPage">-</div>
      </div>
    </div>

    <div class="section region-section">
      <div class="section-title">Defined Regions</div>
      <div class="region-list" id="regionList">
        <div style="text-align: center; color: #6c757d; padding: 20px;">No regions defined yet</div>
      </div>
    </div>

    <div class="section region-section">
      <div class="action-buttons">
        <button class="btn btn-primary" id="saveRegionsBtn" disabled>Save Regions</button>
        <button class="btn btn-warning" id="clearRegionsBtn" disabled>Clear All Regions</button>
      </div>
    </div>
    </div>
  </div>
</section>

<!-- Region Name Modal -->
<div id="regionModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Name This Region</div>
      <span class="close" onclick="closeRegionModal()">&times;</span>
    </div>
    <div class="form-group">
      <label class="form-label">Choose from common fields or type custom:</label>
      <select id="regionNameSelect" class="form-input" onchange="updateRegionNameInput()">
        <option value="">-- Select a common field --</option>
        <option value="Property Address">Property Address</option>
        <option value="Property Name">Property Name</option>
        <option value="Tenant Name">Tenant Name</option>
        <option value="Lease Start Date">Lease Start Date</option>
        <option value="Lease End Date">Lease End Date</option>
        <option value="Base Rent">Base Rent</option>
        <option value="Rent per SF">Rent per SF</option>
        <option value="Leased Square Feet">Leased Square Feet</option>
        <option value="Total Square Feet">Total Square Feet</option>
        <option value="Property Type">Property Type</option>
        <option value="Building Class">Building Class</option>
        <option value="Year Built">Year Built</option>
        <option value="Cap Rate">Cap Rate</option>
        <option value="Price per SF">Price per SF</option>
        <option value="Total Price">Total Price</option>
        <option value="Broker Name">Broker Name</option>
        <option value="Transaction Date">Transaction Date</option>
        <option value="Property Tax">Property Tax</option>
        <option value="Operating Expenses">Operating Expenses</option>
        <option value="NOI">NOI (Net Operating Income)</option>
        <option value="Occupancy Rate">Occupancy Rate</option>
        <option value="Zoning">Zoning</option>
        <option value="Lot Size">Lot Size</option>
        <option value="Parking Spaces">Parking Spaces</option>
        <option value="Floor Count">Floor Count</option>
        <option value="Unit Count">Unit Count</option>
        <option value="Custom Field">-- Type Custom Field --</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Field Name:</label>
      <input type="text" id="regionNameInput" class="form-input" placeholder="e.g., Address, Leased SF, Base Rent">
    </div>
    <div class="action-buttons">
      <button class="btn btn-primary" onclick="saveRegionName()">Save</button>
      <button class="btn btn-warning" onclick="closeRegionModal()">Cancel</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- JavaScript Files -->
<script src="{{ url_for('static', filename='js/pdf-viewer.js') }}"></script>
<script src="{{ url_for('static', filename='js/region-management.js') }}"></script>
<script src="{{ url_for('static', filename='js/excel-preview.js') }}"></script>
<script src="{{ url_for('static', filename='js/data-extraction.js') }}"></script>
<script src="{{ url_for('static', filename='js/keyboard-shortcuts.js') }}"></script>
{% endblock %}
